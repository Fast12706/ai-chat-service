async function sendToAI(message) {
    loading.style.display = 'block';
    sendButton.disabled = true;
    userInput.disabled = true;

    try {
        const response = await fetch('/.netlify/functions/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                patientInfo: message
            })
        });

        const data = await response.json();

        if (data.error) {
            console.error('خطأ في API:', data.error);
            return `حدث خطأ: ${data.error.message || 'خطأ غير معروف'}`;
        }

        // استلام الرد من Claude
        return data.response || "عذراً، لم أستطع فهم الرد من الخدمة.";

    } catch (error) {
        console.error('خطأ في الاتصال:', error);
        return "عذراً، حدث خطأ في الاتصال بالخدمة. الرجاء التحقق من اتصالك بالإنترنت.";
    } finally {
        loading.style.display = 'none';
        sendButton.disabled = false;
        userInput.disabled = false;
    }
}